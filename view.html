<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>내 글 조회</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f9f9f9; }
h1 { text-align:center; margin-bottom:30px; }

.post-card {
  background:#fff;
  padding:20px;
  margin-bottom:20px;
  border-radius:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.post-card h3 { margin:0 0 10px; }
.post-card p { margin:5px 0; }
</style>
</head>
<body>
<h1>내 글 조회</h1>
<div id="postList"></div>

<script>
let posts = JSON.parse(localStorage.getItem("posts") || "[]");
const viewPw = sessionStorage.getItem("viewPw");
const container = document.getElementById("postList");

// 1년 제한 계산
const ONE_YEAR = 365 * 24 * 60 * 60 * 1000;
const now = Date.now();

// 비밀번호로 글 필터
let myPosts = posts.filter(p => p.pw === viewPw);

// 1년 이내 글만 필터
myPosts = myPosts.filter(p => {
  const createdAt = p.createdAt || p.id;
  return (now - createdAt) <= ONE_YEAR;
});

if (myPosts.length === 0) {
  container.innerHTML = "<p>조회 가능한 글이 없습니다.</p>";
} else {
  myPosts.forEach(post => {
    post.views = (post.views || 0) + 1; // 조회수 증가

    const postCard = document.createElement("div");
    postCard.className = "post-card";

    const dateStr = new Date(post.createdAt || post.id).toLocaleString();

    postCard.innerHTML = `
      <h3>작성일: ${dateStr}</h3>
      <p>${post.content}</p>
      <p><strong>조회수:</strong> ${post.views}</p>
    `;

    container.appendChild(postCard);
  });

  // 변경 저장 (조회수 반영)
  localStorage.setItem("posts", JSON.stringify(posts));
}
</script>
</body>
</html>
