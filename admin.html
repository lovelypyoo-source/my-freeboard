<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; background:#f9f9f9; }
h1 { text-align:center; margin-bottom:20px; }

.post-list {
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  overflow: hidden;
}
.post-item {
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
}
.post-item:hover {
  background: #f7f7f7;
}
.post-title {
  font-weight: bold;
}
.post-meta {
  font-size: 12px;
  color: #666;
}

.post-detail {
  display: none;
  margin: 20px auto;
  max-width: 800px;
  background: #fff;
  border-radius: 10px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.post-detail h2 {
  margin-top: 0;
}
.comment-box {
  margin-top: 15px;
}
.comment-box p {
  margin: 5px 0;
}
.comment-input {
  width: 80%;
  padding: 5px;
}
button { margin: 2px; padding: 4px 8px; font-size: 13px; }
</style>
<script>
// 세션 인증 확인
window.onload = function() {
  if (sessionStorage.getItem("adminAuth") !== "true") {
    alert("잘못된 접근입니다. 메인 페이지에서 로그인 후 이용하세요.");
    window.location.href = "index.html";
  }
}

// 데이터 로드 및 저장
let posts = JSON.parse(localStorage.getItem("posts") || "[]"); // 저장된 데이터가 없으면 빈 배열로 초기화
const ONE_YEAR = 365 * 24 * 60 * 60 * 1000;

// 현재 선택된 글 ID
let currentPostId = null;

// 글 목록 렌더링
function renderPostList() {
  const postList = document.getElementById("postList");
  postList.innerHTML = "";

  const now = Date.now();

  posts
    .filter(p => (now - new Date(p.createdAt).getTime()) <= ONE_YEAR) // 1년 이내
    .slice(-500) // 최대 500개
    .forEach((p, idx) => {
      const div = document.createElement("div");
      div.className = "post-item";
      div.onclick = () => openPost(p.id);
      div.innerHTML = `
        <div class="post-title">${p.title || "제목 없음"}</div>
        <div class="post-meta">
          작성자: ${p.author || "익명"} | 조회수: ${p.views || 0} | 작성일: ${new Date(p.createdAt).toLocaleString()}
        </div>
      `;
      postList.appendChild(div);
    });
}

// 글 상세보기
function openPost(id) {
  const post = posts.find(p => p.id == id);
  if (!post) return;

  currentPostId = id;
  document.getElementById("detailTitle").textContent = post.title || "(제목 없음)";
  document.getElementById("detailMeta").textContent = 
    `작성자: ${post.author || "익명"} | 조회수: ${post.views || 0} | 작성일: ${new Date(post.createdAt).toLocaleString()}`;
  document.getElementById("detailContent").textContent = post.content || "";

  renderComments(post);

  document.getElementById("postDetail").style.display = "block";
}

// 댓글 렌더링
function renderComments(post) {
  const commentList = document.getElementById("commentList");
  commentList.innerHTML = "";

  post.comments.forEach((c, i) => {
    const p = document.createElement("p");
    p.innerHTML = `
      ${c}
      <button onclick="editComment('${post.id}', ${i})">수정</button>
      <button onclick="deleteComment('${post.id}', ${i})">삭제</button>
    `;
    commentList.appendChild(p);
  });
}

// 댓글 추가
document.getElementById("addCommentBtn").onclick = function() {
  const input = document.getElementById("newComment");
  const post = posts.find(p => p.id == currentPostId);
  if (!post || !input.value.trim()) return;
  post.comments.push(input.value.trim());
  input.value = "";
  savePosts();
  renderComments(post);
};

// 댓글 수정
function editComment(postId, commentIndex) {
  const post = posts.find(p => p.id == postId);
  const newComment = prompt("댓글 수정:", post.comments[commentIndex]);
  if (newComment && newComment.trim()) {
    post.comments[commentIndex] = newComment.trim();
    savePosts();
    renderComments(post);
  }
}

// 댓글 삭제
function deleteComment(postId, commentIndex) {
  const post = posts.find(p => p.id == postId);
  if (confirm("댓글을 삭제하시겠습니까?")) {
    post.comments.splice(commentIndex, 1);
    savePosts();
    renderComments(post);
  }
}

// 게시글 저장
function savePosts() {
  localStorage.setItem("posts", JSON.stringify(posts));
}

// 로그아웃
function logout() {
  sessionStorage.removeItem("adminAuth");
  alert("로그아웃 되었습니다.");
  window.location.href = "index.html";
}

renderPostList();
</script>
</head>
<body>
<h1>관리자 페이지 - 게시판</h1>

<div class="post-list" id="postList"></div>

<div class="post-detail" id="postDetail">
  <h2 id="detailTitle"></h2>
  <p id="detailMeta"></p>
  <p id="detailContent"></p>
  <div class="comment-box">
    <h4>댓글</h4>
    <div id="commentList"></div>
    <input type="text" id="newComment" class="comment-input" placeholder="댓글 작성">
    <button id="addCommentBtn">등록</button>
  </div>
  <button id="closeDetail">닫기</button>
</div>

<button onclick="logout()">로그아웃</button>
</body>
</html>
