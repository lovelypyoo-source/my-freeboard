<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>
<style>
/* 기존 관리자 스타일 그대로 사용 */
</style>
<script>
  // 세션 인증 확인
  window.onload = function() {
    if (sessionStorage.getItem("adminAuth") !== "true") {
      alert("잘못된 접근입니다. 메인 페이지에서 로그인 후 이용하세요.");
      window.location.href = "index.html";
    }
  }
</script>
</head>
<body>
<h1>관리자 페이지 - 전체 게시판</h1>
<div id="postsContainer"></div>
<button onclick="logout()">로그아웃</button>

<script>
let posts = JSON.parse(localStorage.getItem("posts") || "[]");

function renderPosts() {
  const container = document.getElementById("postsContainer");
  container.innerHTML = "";
  posts.forEach((p,index)=>{
    const div = document.createElement("div");
    div.innerHTML=`
      <h2>글 번호 ${index+1}</h2>
      <textarea id="editContent_${p.id}">${p.content}</textarea>
      <p>조회수: ${p.views}</p>
      <div class="comments">
        <h4>댓글</h4>
        ${p.comments.map(c=>`<p>- ${c}</p>`).join('')}
        <input type="text" id="commentInput_${p.id}" placeholder="댓글 작성">
        <button onclick="addComment('${p.id}')">댓글 등록</button>
      </div>
      <button onclick="savePost('${p.id}')">저장</button>
      <button onclick="deletePost('${p.id}')">삭제</button>
    `;
    container.appendChild(div);
  });
}

function addComment(id){
  const input = document.getElementById(`commentInput_${id}`);
  const post = posts.find(p=>p.id==id);
  if(!post || !input.value.trim()) return;
  post.comments.push(input.value.trim());
  savePosts();
  input.value="";
  renderPosts();
}

function savePost(id){
  const post = posts.find(p=>p.id==id);
  post.content = document.getElementById(`editContent_${id}`).value;
  savePosts();
  alert("저장 완료");
  renderPosts();
}

function deletePost(id){
  if(!confirm("삭제하시겠습니까?")) return;
  posts = posts.filter(p=>p.id!=id);
  savePosts();
  renderPosts();
}

function savePosts(){ localStorage.setItem("posts", JSON.stringify(posts)); }

function logout(){
  sessionStorage.removeItem("adminAuth");
  alert("로그아웃 되었습니다.");
  window.location.href="index.html";
}

renderPosts();
</script>
</body>
</html>
