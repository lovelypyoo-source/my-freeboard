<!-- admin.html : 관리자 페이지 -->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>
<style>
body { font-family: Arial,sans-serif; padding:20px; }
h1 { text-align:center; }
#login { text-align:center; margin-bottom:20px; }
#login input,#login button{padding:10px;font-size:18px;}
.post{border:1px solid #ccc;padding:20px;margin:15px 0;font-size:18px;}
textarea{width:100%;height:200px;font-size:18px;}
input[type=text]{padding:10px;font-size:16px;}
button{padding:10px 15px;font-size:16px;cursor:pointer;}
#pagination button{margin:2px;padding:8px 12px;font-size:16px;}
.comment-form{margin-top:10px;display:flex;gap:5px;}
.comment-form input{flex:1;padding:10px;font-size:16px;}
.post button{margin-top:5px;margin-right:5px;}
#searchBox{margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
@media(max-width:600px){
  body{padding:10px;}
  #login input,#login button{font-size:16px;padding:8px;}
  .post{font-size:16px;padding:15px;}
  textarea{height:150px;font-size:16px;}
  input[type=text]{font-size:14px;padding:8px;}
  button{font-size:14px;padding:8px 12px;}
  #pagination button{font-size:14px;padding:6px 10px;}
  .comment-form input{font-size:14px;padding:8px;}
}
</style>
</head>
<body>
<h1>관리자 페이지</h1>
<div id="login">
<input type="password" id="adminPw" placeholder="관리자 비밀번호" maxlength="30">
<button onclick="checkAdmin()">로그인</button>
</div>
<div id="adminPanel" style="display:none;">
<div id="searchBox">
<input type="text" id="searchInput" placeholder="내용으로 검색" oninput="searchPosts()">
<button onclick="clearSearch()">검색 초기화</button>
<button onclick="exportExcel()">엑셀로 내보내기</button>
</div>
<div id="posts"></div>
<div id="pagination"></div>
</div>

<script>
let posts=JSON.parse(localStorage.getItem("posts")||"[]").map(p=>({...p}));
let filteredPosts=[...posts];
let currentPage=1;
const perPage=10;

function checkAdmin(){
  const pw=document.getElementById("adminPw").value;
  if(pw==="dobong09!"){
    document.getElementById("login").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    renderPosts();
  }else{ alert("비밀번호가 일치하지 않습니다."); }
}

function renderPosts(){
  const start=(currentPage-1)*perPage;
  const end=start+perPage;
  const pagePosts=filteredPosts.slice(start,end);
  const postsDiv=document.getElementById("posts");
  postsDiv.innerHTML="";
  pagePosts.forEach(p=>{
    const div=document.createElement("div");
    div.className="post";
    div.innerHTML=`
      <p><strong>내용:</strong></p>
      <textarea id="editContent_${p.id}">${p.content}</textarea>
      <p><strong>조회수:</strong> ${p.views}</p>
      <p><strong>댓글:</strong> ${p.comments.join(", ")}</p>
      <div class="comment-form">
        <input type="text" id="commentInput_${p.id}" placeholder="관리자 댓글 입력">
        <button onclick="addComment('${p.id}')">댓글 등록</button>
      </div>
      <button onclick="savePost('${p.id}')">게시글 저장</button>
      <button onclick="deletePost('${p.id}')">게시글 삭제</button>
    `;
    postsDiv.appendChild(div);
  });
  renderPagination();
}

function renderPagination(){
  const totalPages=Math.ceil(filteredPosts.length/perPage);
  const paginationDiv=document.getElementById("pagination");
  paginationDiv.innerHTML="";
  for(let i=1;i<=totalPages;i++){
    const btn=document.createElement("button");
    btn.textContent=i;
    if(i===currentPage) btn.disabled=true;
    btn.onclick=()=>{ currentPage=i; renderPosts(); }
    paginationDiv.appendChild(btn);
  }
}

function searchPosts(){
  const query=document.getElementById("searchInput").value.toLowerCase();
  filteredPosts=posts.filter(p=>p.content.toLowerCase().includes(query));
  currentPage=1;
  renderPosts();
}
function clearSearch(){ document.getElementById("searchInput").value=""; filteredPosts=[...posts]; currentPage=1; renderPosts(); }

function addComment(id){
  const input=document.getElementById(`commentInput_${id}`);
  const post=posts.find(p=>p.id==id);
  if(!post || !input.value.trim()) return;
  post.comments.push(input.value.trim());
  savePosts();
  input.value="";
  renderPosts();
}

function savePost(id){
  const post=posts.find(p=>p.id==id);
  if(!post) return;
  post.content=document.getElementById(`editContent_${id}`).value;
  savePosts();
  alert("게시글이 저장되었습니다.");
  renderPosts();
}

function deletePost(id){
  if(!confirm("정말 삭제하시겠습니까?")) return;
  posts=posts.filter(p=>p.id!=id);
  filteredPosts=filteredPosts.filter(p=>p.id!=id);
  savePosts();
  renderPosts();
}

function savePosts(){ localStorage.setItem("posts",JSON.stringify(posts)); }

function exportExcel(){
  let csv="내용,조회수,댓글\n";
  filteredPosts.forEach(p=>{
    const line=`"${p.content.replace(/"/g,'""')}",${p.views},"${p.comments.join("; ").replace(/"/g,'""')}"\n`;
    csv+=line;
  });
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="게시글.csv";
  link.click();
}
</script>
</body>
</html>
