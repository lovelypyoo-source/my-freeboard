<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>
<style>
/* 기존 관리자 스타일 그대로 사용 */
</style>
<script>
// 세션 인증 확인
window.onload = function() {
  if (sessionStorage.getItem("adminAuth") !== "true") {
    alert("잘못된 접근입니다. 메인 페이지에서 로그인 후 이용하세요.");
    window.location.href = "index.html";
  }
}
</script>
</head>
<body>
<h1>관리자 페이지 - 전체 게시판</h1>
<div id="postsContainer"></div>
<button onclick="logout()">로그아웃</button>

<script>
let posts = JSON.parse(localStorage.getItem("posts") || "[]");

function renderPosts() {
  const container = document.getElementById("postsContainer");
  container.innerHTML = "";

  const currentDate = new Date();

  posts.forEach((p, index) => {
    const postDate = new Date(p.createdAt);  // 문자열로 저장된 createdAt을 Date 객체로 변환
    if (isNaN(postDate)) {
      console.error(`Invalid date for post ID: ${p.id}`);
      return; // Invalid date인 경우 해당 글을 표시하지 않음
    }
    
    const diffInTime = currentDate - postDate;
    const diffInDays = diffInTime / (1000 * 3600 * 24); // 일 단위 차이

    // 1년이 지난 글은 삭제하거나 표시하지 않도록 할 수 있음
    if (diffInDays > 365) {
      return; // 1년이 지난 글은 렌더링 하지 않음
    }

    const div = document.createElement("div");
    div.innerHTML = `
      <h2>글 번호 ${index+1}</h2>
      <textarea id="editContent_${p.id}">${p.content}</textarea>
      <p>작성일: ${postDate.toLocaleDateString()}</p>  <!-- 작성일을 사람이 읽을 수 있는 형식으로 출력 -->
      <p>조회수: ${p.views}</p>
      <div class="comments">
        <h4>댓글</h4>
        ${p.comments.map(c => `<p>- ${c}</p>`).join('')}
        <input type="text" id="commentInput_${p.id}" placeholder="댓글 작성">
        <button onclick="addComment('${p.id}')">댓글 등록</button>
      </div>
      <button onclick="savePost('${p.id}')">저장</button>
      <button onclick="deletePost('${p.id}')">삭제</button>
    `;
    container.appendChild(div);
  });
}

function addComment(id) {
  const input = document.getElementById(`commentInput_${id}`);
  const post = posts.find(p => p.id == id);
  if (!post || !input.value.trim()) return;
  post.comments.push(input.value.trim());
  savePosts();
  input.value = "";
  renderPosts();
}

function savePost(id) {
  const post = posts.find(p => p.id == id);
  post.content = document.getElementById(`editContent_${id}`).value;
  savePosts();
  alert("저장 완료");
  renderPosts();
}

function deletePost(id) {
  if (!confirm("삭제하시겠습니까?")) return;
  posts = posts.filter(p => p.id != id);
  savePosts();
  renderPosts();
}

function savePosts() {
  localStorage.setItem("posts", JSON.stringify(posts));
}

function logout() {
  sessionStorage.removeItem("adminAuth");
  alert("로그아웃 되었습니다.");
  window.location.href = "index.html";
}

// 게시글 작성 시 작성일을 저장
function createPost(content) {
  const newPost = {
    id: Date.now().toString(), // 고유 ID로 작성
    content: content,
    comments: [],
    views: 0,
    createdAt: new Date().toISOString() // 작성일 추가
  };
  posts.push(newPost);
  savePosts();
  renderPosts();
}

renderPosts();
</script>
</body>
</html>
