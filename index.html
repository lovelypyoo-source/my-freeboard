<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>나의 게시판</title>
<style>
@font-face {
  font-family: 'KOROAD';
  src: url('KOROAD.ttf') format('truetype');
}
body { font-family: 'KOROAD', Arial, sans-serif; margin:0; padding:0; text-align:center; background:#f9f9f9; }
header { display:flex; align-items:center; justify-content:center; background:#f5f5f5; padding:60px; flex-wrap:wrap; }
header h1 { margin:0; font-size:96px; }
header img { margin-left:40px; height:160px; }
.main-box { margin:80px auto; display:flex; flex-direction:column; align-items:center; gap:60px; padding:0 100px; max-width:2400px; }
.speech-bubble { position:relative; background:#fff; border:2px solid #ddd; border-radius:60px; padding:120px; font-size:72px; font-weight:bold; max-width:95%; box-shadow:4px 4px 32px rgba(0,0,0,0.1); }
.speech-bubble::after { content:""; position:absolute; bottom:-80px; left:160px; border-width:80px 80px 0; border-style:solid; border-color:#fff transparent transparent transparent; filter:drop-shadow(4px 8px 8px rgba(0,0,0,0.1)); }
.buttons { display:flex; justify-content:center; gap:60px; flex-wrap:wrap; z-index:1; }
button { font-size:56px; padding:40px 80px; border:none; border-radius:32px; background:#4CAF50; color:white; cursor:pointer; min-width:360px; }
button:hover { background:#45a049; }
.main-image { max-width:40%; width:auto; height:auto; margin-top:40px; }
.post { border:1px solid #ccc; padding:60px; margin:60px auto; width:95%; max-width:1600px; text-align:left; border-radius:48px; background:#fafafa; font-size:48px; line-height:3.6; }
.post button { font-size:40px; padding:24px 48px; margin-right:24px; margin-top:24px; }
.comments { margin-top:40px; padding-left:40px; border-left:8px solid #ccc; font-size:40px; }
.comments p { margin:16px 0; }
.comment-form { margin-top:40px; display:flex; flex-direction:column; gap:24px; }
.comment-form input { padding:32px; font-size:40px; width:100%; box-sizing:border-box; border-radius:16px; border:2px solid #ccc; }
.comment-form button { font-size:40px; padding:24px 48px; background-color:#2196F3; }

/* 관리자 버튼 하단 하나만, 짙은 회색 */
.admin-link button { 
  font-size:28px; 
  padding:15px 30px; 
  min-width:180px; 
  background-color:#333; 
  color:white; 
  border-radius:8px; 
  cursor:pointer;
}
.admin-link button:hover { background-color:#555; }

footer { margin-top:120px; }

/* 모바일 최적화 */
@media (max-width:768px) {
  header h1 { font-size:36px; }
  header img { height:60px; }
  .speech-bubble { font-size:28px; padding:45px; }
  .buttons button { font-size:24px; padding:16px 32px; width:45%; }
  .main-image { max-width:90%; margin-top:15px; }
  .post { font-size:20px; padding:24px; }
  .post button { font-size:18px; padding:10px 20px; }
  .comments { font-size:18px; padding-left:15px; }
  .comment-form input { font-size:18px; padding:12px; }
  .comment-form button { font-size:18px; padding:10px 20px; }
  #forms textarea { width:100%; height:250px; font-size:18px; padding:12px; }
  #forms input[type="password"] { font-size:18px; padding:10px; width:100%; }
  #forms button { font-size:18px; padding:12px 25px; }

  /* 모바일에서 관리자 버튼 숨기기 */
  .admin-link { display:none; }
}

/* PC textarea 10줄 이상 보이도록 확대 */
@media (min-width:769px) {
  #forms textarea { width:100%; height:500px; font-size:40px; padding:20px; }
  #forms input[type="password"] { font-size:40px; padding:20px; width:100%; }
  #forms button { font-size:40px; padding:30px 60px; }
}
</style>
</head>
<body>
<header>
  <h1>나의 게시판</h1>
  <img src="그림1.png" alt="그림1">
</header>

<div class="main-box">
  <div class="speech-bubble">어떤 건의사항이 있으신가요?</div>
  <div class="buttons">
    <button onclick="showWriteForm()">글쓰기</button>
    <button onclick="viewMyPost()">조회</button>
  </div>
  <img src="그림2.png" alt="그림2" class="main-image">
</div>

<div id="forms"></div>
<div id="posts"></div>

<!-- 관리자 버튼 하단 하나만, PC에서만 보이도록 -->
<div class="admin-link" id="adminLink">
  <button onclick="goAdmin()">관리자 페이지</button>
</div>

<footer>
  <p style="color:#888; font-size:36px;">Powered by 나의 게시판</p>
</footer>

<script>
let posts = JSON.parse(localStorage.getItem("posts") || "[]");

// 글쓰기
function showWriteForm(){
  document.getElementById("forms").innerHTML=`
    <h3>글쓰기</h3>
    <textarea id="content" placeholder="내용을 입력하세요"></textarea><br>
    <input type="password" id="pw" placeholder="비밀번호(4자리)" maxlength="4"><br>
    <button onclick="savePost()">입력완료</button>
  `;
}

function savePost(){
  const content=document.getElementById("content").value.trim();
  const pw=document.getElementById("pw").value.trim();
  if(!content||pw.length!==4){
    alert("내용과 4자리 비밀번호를 입력하세요.");
    return;
  }
  const newPost = {
    id: Date.now(),
    content,
    pw,
    views: 0,
    comments: [],
    createdAt: new Date().toISOString() // 작성일 무조건 저장
  };
  posts.push(newPost);

  // 500개 초과 방지 (오래된 글 제거)
  if(posts.length > 500){
    posts = posts.slice(posts.length - 500);
  }

  localStorage.setItem("posts", JSON.stringify(posts));
  alert("글이 등록되었습니다.");
  document.getElementById("forms").innerHTML="";
}


  localStorage.setItem("posts", JSON.stringify(posts));
  alert("글이 등록되었습니다.");
  document.getElementById("forms").innerHTML="";
}

  // 최대 500개까지만 저장
  if(posts.length > 500){
    posts = posts.slice(posts.length - 500);
  }

  localStorage.setItem("posts", JSON.stringify(posts));
  alert("글이 등록되었습니다.");
  document.getElementById("forms").innerHTML="";
}

// 조회 버튼 → 비밀번호 프롬프트 → 맞으면 view.html 이동
function viewMyPost(){
  const inputPw = prompt("작성 시 입력한 비밀번호를 입력하세요:");
  if(!inputPw) return;
  if(inputPw.length!==4){alert("비밀번호는 4자리입니다."); return;}

  // 1년 이내 글만 필터
  const now = new Date();
  const oneYearAgo = new Date();
  oneYearAgo.setFullYear(now.getFullYear() - 1);

  const myPosts = posts.filter(p=>{
  let postDate;
  if (p.createdAt) {
    postDate = new Date(p.createdAt);
  } else {
    postDate = new Date(parseInt(p.id));
  }
  if (isNaN(postDate)) return false;
  return p.pw===inputPw && postDate >= oneYearAgo;
});

  if(myPosts.length===0){
    alert("해당 비밀번호로 조회 가능한 글이 없습니다. (1년 이내 글만 조회 가능)");
    return;
  }

  sessionStorage.setItem("viewPw", inputPw);
  window.location.href="view.html";
}

// 관리자 버튼 → 프롬프트 → 맞으면 admin.html
function goAdmin(){
  const inputPw = prompt("관리자 비밀번호를 입력하세요:");
  if(inputPw==="dobong09!"){
    sessionStorage.setItem("adminAuth","true"); // admin.html과 동일한 키
    window.location.href="admin.html";
  }else{
    alert("비밀번호가 올바르지 않습니다.");
  }
}

// PC 여부 확인하여 관리자 버튼 표시
function checkDevice(){
  const ua = navigator.userAgent.toLowerCase();
  const isMobile = /android|iphone|ipad|ipod|mobile/i.test(ua);
  document.getElementById("adminLink").style.display = isMobile ? "none" : "block";
}
window.onload = checkDevice;
</script>
</body>
</html>
